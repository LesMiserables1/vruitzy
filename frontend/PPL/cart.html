<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Favicon -->
  <link rel="shortcut icon" href="./images/Logo.png" type="image/x-icon">

  <!-- Box icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css" />
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">

  <!-- Custom StyleSheet -->
  <link rel="stylesheet" href="./css/styles.css" />
  <title>Your Cart</title>
  <style>
    .aaa:hover{
        color: white;
        background-color: rgb(133, 235, 133);
    }
    .bbb:checked + label{
        background: green;
        color: rgb(0, 0, 0);
    }
  </style>
</head>



<body>
  <!-- Navigation -->
  <nav class="nav">
    <div class="navigation container">
      <div class="logo">
        <h1><a href="index.html"><img class="tanda" src="./images/logo.png" alt="">ruitzy</a></h1>
      </div>

      <div class="menu">
        <div class="top-nav">
          <div class="logo">
            <h1>Vruitzy</h1>
          </div>
          <div class="close">
            <i class="bx bx-x"></i>
          </div>
        </div>

        <ul class="nav-list">
          <li class="nav-item">
            <a href="index.html" class="nav-link">Home</a>
          </li>
          <li class="nav-item">
            <a href="product.html" class="nav-link">Products</a>
          </li>
          <li class="nav-item">
            <a href="profileBuyer.html" class="nav-link">Profile</a>
          </li>
          <li class="nav-item">
            <a href="cart.html" class="nav-link">Cart</a>
          </li>
          <li class="nav-item">
            <a href="awal.html" class="nav-link">Logout</a>
          </li>
          <li class="nav-item">
            <a href="cart.html" class="nav-link icon"><i class="bx bx-shopping-bag"></i></a>
          </li>
        </ul>
      </div>

      <a href="cart.html" class="cart-icon">
        <i class="bx bx-shopping-bag"></i>
      </a>

      <div class="hamburger">
        <i class="bx bx-menu"></i>
      </div>
    </div>
  </nav>

  <!-- Cart Items -->

  <div class="container-md cart">
    

    <table class="cartItems">
      <tr>
        <th>Product</th>
        <th>Quantity</th>
        <th>Subtotal</th>
      </tr>
      <!-- <tr>
        <td>
          <div class="cart-info">
            <img src="./images/Apple.jpg" alt="">
            <div>
              <p>Apple</p>
              <span>Price: $50.00</span>
              <br />
              <a href="#">remove</a>
            </div>
          </div>
        </td>
        <td><input type="number" value="1" min="1"></td>
        <td>$50.00</td>
      </tr>
      <tr>
        <td>
          <div class="cart-info">
            <img src="./images/Lemons.png" alt="">
            <div>
              <p>Lemons</p>
              <span>Price: $90.00</span>
              <br />
              <a href="#">remove</a>
            </div>
          </div>
        </td>
        <td><input type="number" value="1" min="1"></td>
        <td>$90.00</td>
      </tr>
      <tr>
        <td>
          <div class="cart-info">
            <img src="./images/Cucumber.jpg" alt="">
            <div>
              <p>Cucumber</p>
              <span>Price: $60.00</span>
              <br />
              <a href="#">remove</a>
            </div>
          </div>
        </td>
        <td><input type="number" value="1" min="1"></td>
        <td>$60.00</td>
      </tr>
      <tr>
        <td>
          <div class="cart-info">
            <img src="./images/Tomatoes.jpg" alt="">
            <div>
              <p>Tomatoes</p>
              <span>Price: $60.00</span>
              <br />
              <a href="#">remove</a>
            </div>
          </div>
        </td>
        <td><input type="number" value="1" min="1"></td>
        <td>$60.00</td>
      </tr>
      <tr>
        <td>
          <div class="cart-info">
            <img src="./images/Oranges.jpg" alt="">
            <div>
              <p>Oranges</p>
              <span>Price: $60.00</span>
              <br />
              <a href="#">remove</a>
            </div>
          </div>
        </td>
        <td><input type="number" value="1" min="1"></td>
        <td>$60.00</td> 
      </tr>-->
      <div class="disini">
        
      </div>
    </table>
        <ul>
          <li style="margin-top: 3%; border: 2px solid green; padding-bottom: 15px; color: green; width: 20%; text-align: center; font-weight: 700;" class="aaa">
              <input type='radio' onclick="saveTransport1()" style="visibility:hidden;" value='1' name='radio' id='radio1' class="bbb"/>
              <label style="cursor: pointer;" for='radio1'>
                  <p>JNE</p>
                  <p>Rp20000</p>
              </label>
          </li>

          <li style="margin-top: 3%; border: 2px solid green; padding-bottom: 15px; color: green; width: 20%; text-align: center; font-weight: 700;" class="aaa">
              <input type='radio' onclick="saveTransport2()" style="visibility:hidden;" value='2' name='radio'  id='radio2' class="bbb"/>
              <label style="cursor: pointer;" for='radio2'>
                  <p>JNT</p>
                  <p>Rp15000</p>
              </label>
          </li>

          <!-- <li style="margin-top: 3%; border: 2px solid green; padding-bottom: 15px; color: green; width: 20%; text-align: center; font-weight: 700;" class="aaa">
              <input type='radio' style="visibility:hidden;" value='3' name='radio'  id='radio3' class="bbb"/>
              <label style="cursor: pointer;" for='radio3'>
                  <p>Transport 3</p>
                  <p>Harga</p>
              </label>
          </li> -->
      </ul>
    <div class="total-price">
      <table>
        <!-- <tr>
          <td>Subtotal</td>
          <td>$320</td>
        </tr>
        <tr>
          <td>Delivery</td>
          <td>$50</td>
        </tr>
        <tr>
          <td>Total</td>
          <td>$370</td>
        </tr> -->
      </table>
      <!-- <a href="payment.html" class="checkout btn">Proceed To Checkout</a> -->

    </div>

  </div>



  <!-- Footer -->
  <footer class="footer-distributed">

    <div class="footer-left">

      <h3>Vruitzy</h3>

      <p class="footer-links">
        Vruitzy is an e-commerce platform that
        offers high-quality fresh fruits while
        staying at home!
      </p>


    </div>

    <div class="footer-center">

    </div>
    <div class="footer-right">

      <p class="footer-company-about">
        <span>Follow Us!</span>
      </p>

      <div class="footer-icons">

        <a href="#"><i class="fa fa-facebook"></i></a>
        <a href="#"><i class="fa fa-twitter"></i></a>
        <a href="#"><i class="fa fa-linkedin"></i></a>
        <a href="#"><i class="fa fa-github"></i></a>

      </div>

    </div>
    <p class="footer-company-name">Vruitzy &copy; 2020</p>
  </footer>
  <footer>
    <p>2020 &copy; Vruitzy | All rights reserved.</p>
  </footer>
  <!-- End Footer -->

  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.5.1/gsap.min.js"></script>
  <!-- Custom Script -->
  <script src="./js/index.js"></script>


  <script>
    var shipmentId=1;
    var delivfee=0
    function saveTransport1() {
         shipmentId = 1;
         delivfee=20000
         let fee = document.querySelector('.fee')
         fee.innerHTML = 
            `<td>Delivery fee (Rp)</td>
            <td>${delivfee}</td>`
        //
        //console.log(baru)
        var harga = parseInt(document. getElementById("harga").textContent)
        let baru = delivfee+harga
        let fix = document.querySelector('.totalfix')
         fix.innerHTML = 
            `<td>Total Price (Rp) </td>
            <td>${baru}</td>`    
        localStorage.setItem('totalharga', baru)
      }

      function saveTransport2() {
         shipmentId = 2;
         delivfee=15000
         let fee = document.querySelector('.fee')
         fee.innerHTML = 
            `<td>Delivery fee (Rp)</td>
            <td>${delivfee}</td>`
        //
        //console.log(baru)
        var harga = parseInt(document. getElementById("harga").textContent)
        let baru = delivfee+harga
        let fix = document.querySelector('.totalfix')
         fix.innerHTML = 
            `<td>Total Price (Rp) </td>
            <td>${baru}</td>`    
        localStorage.setItem('totalharga', baru)
      }



    let hasil = document.querySelector('.cartItems')
    
    
    var cart = JSON.parse(localStorage.getItem("cart"));
   
    console.log(cart)

    var i;
    if (cart.length !== 0) {
      let total_harga = 0
      
      let details = []
      let promises = []
      for (i = 0; i < cart.length; i++) {
        let productId = cart[i][0];
        let jumlah = cart[i][1];

        console.log(productId)
        console.log(jumlah)

        let buat_details = {
          "productId": productId,
          "jumlah": jumlah
        }
        details.push(buat_details)

        let data = {
          "productId": productId
        }
        promises.push(fetch('http://dev-story.my.id:3011/customer/retrieve/product', {
          method: 'post',
          headers: {
            'Content-Type': 'application/json',
            'auth-token': localStorage.getItem('token')
          },
          body: JSON.stringify(data)
        }))
      }
      const awaitJson = (responses) => Promise.all(responses.map(response => {
        if(response.ok) return response.json();
        throw new Error(response.statusText);
      }));
      Promise.all(promises)
        .then(async res => {
          
          for(let i = 0; i < res.length; ++i){
            let jumlah = cart[i][1];
            let response = await res[i].json()
            //let toko = response.data.store.nama_toko
           // console.log(toko)
            console.log(response)
          if (response.status == 'ok') {
            let hargapro = jumlah * response.data.harga
            total_harga += hargapro
            console.log(hargapro)
            console.log(total_harga)
            
            
            hasil.innerHTML +=
              `<tr>
                    <td>
                      <div class="cart-info">
                        <img src="./images/Apple.jpg" alt="">
                        <div>
                          <p>${response.data.nama_product}</p>
                          <span>Price: ${response.data.harga}</span>
                          <br />
                          <a href="#">remove</a>
                        </div>
                      </div>
                    </td>
                    <td>${jumlah}</td>
                    <td>${hargapro}</td>
                  </tr>`
          }
          
        }
       
        
        let totalfix = total_harga + delivfee
        
        let total = document.querySelector('.total-price')
        total.innerHTML = `<table>
          
          <tr>
            <td>Subtotal (Rp)</td>
            <td id="harga">${total_harga}</td>
          </tr>
          <tr class="fee">
            <td>Delivery fee (Rp)</td>
            <td>${delivfee}</td>
          </tr>
          <tr class="totalfix">
            <td>Total Price (Rp)</td>
            <td>${totalfix}</td>
          </tr>
        </table>
        <a href="payment.html" class="checkout btn">Proceed To Checkout</a>`

        const checkoutBtn = document.querySelector('.checkout')
      checkoutBtn.onclick = ((e) => {
        e.preventDefault()
        console.log(shipmentId)
        let new_order = {
          "order_details": details,
          "typeShipmentId": shipmentId
        }
        console.log(details)

        fetch('http://dev-story.my.id:3011/customer/create/order', {

          method: 'post',
          headers: {
            'Content-Type': 'application/json',
            'auth-token': localStorage.getItem('token')
          },
          body: JSON.stringify(new_order)
        })
          .then(async res => {
            let response = await res.json();
            console.log(response)
           
            localStorage.setItem('orderId', response.orderId) 
           
            //window.location.href = "file:///C:/Users/Sherine%20Devi/PPL/vruitzy/frontend/PPL/payment.html"
            window.location.href = 'http://dev-story.my.id:3011/payment.html';
          })


      });

      })

      


      



    }





  </script>


</body>

</html>